<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.archive.archive_project_backend.repository.TagMapper">

    <resultMap id="tagMap" type="com.archive.archive_project_backend.entity.Tag">
        <id property="tagId" column="tag_id"/>
        <result property="tagName" column="tag_name"/>
    </resultMap>

<!--  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  -->

    <insert id="insertTags">
        insert ignore into
            tag(tag_name)
        values
            <foreach collection="tags" item="tag" separator=",">
                (#{tag.tagName})
            </foreach>
    </insert>

    <select id="getTagsByTagNames" resultMap="tagMap">
        select
            tag_id,
            tag_name
        from
            tag
        where
            tag_name in
            <foreach collection="tags" item="tag" separator="," open="(" close=")">
                #{tag.tagName}
            </foreach>
    </select>

    <insert id="insertWritingTags">
        insert into
            writing_tag(tag_id, writing_uuid)
        values
            <foreach collection="tags" item="tag" separator=",">
                (#{tag.tagId}, #{writingUuid})
            </foreach>
    </insert>

    <select id="selectTagsByWritingUuid" resultMap="tagMap">
        select
            t.tag_id,
            t.tag_name
        from
            writing_tag wt
        inner join writing w
            on w.writing_uuid = wt.writing_uuid
        inner join tag t
            on t.tag_id = wt.tag_id
        where
            w.writing_uuid = #{writingUuid}
    </select>

    <delete id="deleteWritingTag">
        delete from
            writing_tag
        where
            writing_uuid = #{writingUuid}
    </delete>
</mapper>